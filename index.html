<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‚‰å°¼å»å“ªé‡Œ | Sydney Places Guide</title> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        [x-cloak] { display: none !important; }
        
        .glass-effect { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(14, 165, 233, 0.1);
        }
        .btn-transition { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .btn-active-primary {
            background-color: #0284c7 !important;
            color: #fff !important;
            border-color: #0284c7 !important;
            box-shadow: 0 4px 6px -1px rgba(2, 132, 199, 0.3);
        }

        .btn-active-slate { background-color: #475569 !important; color: white !important; border-color: #475569 !important; }
        .btn-active-teal { background-color: #0d9488 !important; color: white !important; border-color: #0d9488 !important; }

        .bg-nature {
            background-color: #E0F2F1;
            background-image: linear-gradient(160deg, #E0F2F1 0%, #B2EBF2 50%, #E3F2FD 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="bg-nature text-slate-800 antialiased" x-data="placesApp()">

    <header class="glass-effect sticky top-0 z-40 transition-all duration-300 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-2">
                <div class="text-center md:text-left">
                    <h1 class="text-l font-black text-slate-900 tracking-tight flex items-center gap-2 justify-center md:justify-start">
                        <span>æ‚‰å°¼å»å“ªé‡Œ | Sydney Places Guide</span>
                    </h1>
                    
                    <div class="flex items-center justify-center md:justify-start gap-3 mt-2">
                        <p class="text-xs text-gray-600 font-bold tracking-wide uppercase mt-1">å‘¨æœ«å‡è£…ä¸æ— èŠ </p>
                        <button @click="shareApp()" class="text-[10px] font-bold text-slate-500 hover:text-sky-600 hover:bg-white flex items-center gap-1 transition-colors bg-white/50 border border-slate-200 px-3 py-1 rounded-full shadow-sm">
                            ğŸ“¤ åˆ†äº«
                        </button>
                        <a href="mailto:yanghao9397@gmail.com?subject=Feedback" class="text-[10px] font-bold text-gray-600 hover:text-black hover:bg-white flex items-center gap-1 transition-colors bg-white/50 border border-gray-300 px-3 py-1 rounded-full shadow-sm">
                            ğŸ’¬ åé¦ˆ
                        </a>
                    </div>
                </div>
                
                <div class="flex gap-3 w-full md:w-auto">
                    <div class="relative flex-grow md:flex-grow-0 md:w-64 group">
                        <input x-model="search" @input="isShuffleMode = false; currentPage = 1" type="text" placeholder="ğŸ” æœæ™¯ç‚¹ã€åŒºåŸŸã€ç©æ³•..." 
                            class="w-full pl-9 pr-4 py-2.5 rounded-2xl border-2 border-transparent bg-white focus:border-sky-400 focus:ring-0 outline-none text-sm font-medium transition-all shadow-md placeholder-slate-400">
                    </div>
                    
                    <button @click="shuffleView()" 
                        class="bg-white hover:bg-sky-50 text-slate-700 border-2 border-white hover:border-sky-200 px-4 py-2 rounded-2xl text-sm font-bold shadow-md transition-all duration-300 flex items-center gap-2 whitespace-nowrap transform hover:-translate-y-0.5">
                        <span>ğŸ”€</span> <span class="hidden sm:inline">éšä¾¿çœ‹</span>
                    </button>

                    <button @click="pickRandom()" 
                        class="bg-slate-900 hover:bg-sky-600 text-white border-2 border-transparent px-5 py-2 rounded-2xl text-sm font-bold shadow-lg hover:shadow-sky-500/30 transition-all duration-300 flex items-center gap-2 whitespace-nowrap transform hover:-translate-y-1">
                        <span>ğŸ²</span> <span class="hidden sm:inline">å¸®æˆ‘é€‰</span><span class="sm:hidden">é€‰</span>
                    </button>
                </div>
            </div>

            <div class="pb-1">
                <div x-show="showFilters" x-collapse class="space-y-3 pt-2">
                    
                    <div class="border-t border-dashed border-slate-300/50 pt-2" :class="expanded.pop ? 'overflow-visible' : 'overflow-x-auto hide-scroll'">
                        <div :class="expanded.pop ? 'flex flex-wrap gap-2 items-center' : 'flex space-x-2 min-w-max items-center'">
                            <div @click="toggleExpand('pop')" class="cursor-pointer flex items-center gap-1 mr-2 px-1 py-1 rounded hover:bg-slate-100 transition-colors select-none">
                                <span class="text-xs font-black text-slate-400 uppercase w-12 shrink-0">ğŸ”¥ çƒ­åº¦</span>
                                <span class="text-[8px] text-slate-400" x-text="expanded.pop ? 'â–²' : 'â–¼'"></span>
                            </div>
                            <button @click="activePopularity = []; currentPage = 1" 
                                    :class="activePopularity.length === 0 ? 'bg-slate-800 text-white' : 'bg-white text-slate-600 hover:text-black'" 
                                    class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm">å…¨éƒ¨</button>
                            
                            <button @click="toggleFilter('activePopularity', 3)" 
                                    :class="activePopularity.includes(3) ? 'btn-active-primary' : 'bg-white text-slate-600 hover:text-sky-600'" 
                                    class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">
                                ğŸš© æ‰“å¡åœ°æ ‡
                            </button>
                            <button @click="toggleFilter('activePopularity', 2)" 
                                    :class="activePopularity.includes(2) ? 'btn-active-primary' : 'bg-white text-slate-600 hover:text-sky-600'" 
                                    class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">
                                ğŸŒŸ æ‡‚è¡Œä¹‹é€‰
                            </button>
                            <button @click="toggleFilter('activePopularity', 1)" 
                                    :class="activePopularity.includes(1) ? 'btn-active-primary' : 'bg-white text-slate-600 hover:text-sky-600'" 
                                    class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">
                                ğŸ’ ç§è—å†·é—¨
                            </button>
                        </div>
                    </div>

                    <div class="border-t border-dashed border-slate-300/50 pt-2" :class="expanded.dist ? 'overflow-visible' : 'overflow-x-auto hide-scroll'">
                        <div :class="expanded.dist ? 'flex flex-wrap gap-2 items-center' : 'flex space-x-2 min-w-max items-center'">
                            <div @click="toggleExpand('dist')" class="cursor-pointer flex items-center gap-1 mr-2 px-1 py-1 rounded hover:bg-slate-100 transition-colors select-none">
                                <span class="text-xs font-black text-slate-400 uppercase w-12 shrink-0">ğŸš— è·ç¦»</span>
                                <span class="text-[8px] text-slate-400" x-text="expanded.dist ? 'â–²' : 'â–¼'"></span>
                            </div>
                            <button @click="activeDistances = []; currentPage = 1" 
                                    :class="activeDistances.length === 0 ? 'bg-slate-800 text-white' : 'bg-white text-slate-600 hover:text-black'" 
                                    class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm">å…¨éƒ¨</button>
                            
                            <button @click="toggleFilter('activeDistances', 'walk')" 
                                    :class="activeDistances.includes('walk') ? 'btn-active-slate' : 'bg-white text-slate-600 hover:text-slate-800'" 
                                    class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">
                                ğŸš¶ æ­¥è¡Œ (<3km)
                            </button>
                            <button @click="toggleFilter('activeDistances', 'close')" 
                                    :class="activeDistances.includes('close') ? 'btn-active-slate' : 'bg-white text-slate-600 hover:text-slate-800'" 
                                    class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">
                                ğŸš— è¿‘éƒŠ (3-10km)
                            </button>
                            <button @click="toggleFilter('activeDistances', 'mid')" 
                                    :class="activeDistances.includes('mid') ? 'btn-active-slate' : 'bg-white text-slate-600 hover:text-slate-800'" 
                                    class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">
                                ğŸš™ ä¸­é€” (10-40km)
                            </button>
                            <button @click="toggleFilter('activeDistances', 'far')" 
                                    :class="activeDistances.includes('far') ? 'btn-active-slate' : 'bg-white text-slate-600 hover:text-slate-800'" 
                                    class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">
                                ğŸï¸ è¿œé€” (>40km)
                            </button>
                        </div>
                    </div>

                    <div class="border-t border-dashed border-slate-300/50 pt-2" :class="expanded.cats ? 'overflow-visible' : 'overflow-x-auto hide-scroll'">
                        <div :class="expanded.cats ? 'flex flex-wrap gap-2 items-center' : 'flex space-x-2 min-w-max items-center'">
                            <div @click="toggleExpand('cats')" class="cursor-pointer flex items-center gap-1 mr-2 px-1 py-1 rounded hover:bg-slate-100 transition-colors select-none">
                                <span class="text-xs font-black text-slate-400 uppercase w-12 shrink-0">ğŸ’ ç©æ³•</span>
                                <span class="text-[8px] text-slate-400" x-text="expanded.cats ? 'â–²' : 'â–¼'"></span>
                            </div>
                            <button @click="activeCategories = []; currentPage = 1" :class="activeCategories.length === 0 ? 'bg-teal-600 text-white' : 'bg-white text-slate-600 hover:text-teal-600'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm">å…¨éƒ¨</button>
                            <template x-for="cat in categories" :key="cat">
                                <button @click="toggleFilter('activeCategories', cat)" :class="activeCategories.includes(cat) ? 'btn-active-teal' : 'bg-white text-slate-600 hover:text-teal-600'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm" x-text="cat"></button>
                            </template>
                        </div>
                    </div>

                    <div class="border-t border-dashed border-slate-300/50 pt-2" :class="expanded.regions ? 'overflow-visible' : 'overflow-x-auto hide-scroll'">
                        <div :class="expanded.regions ? 'flex flex-wrap gap-2 items-center' : 'flex space-x-2 min-w-max items-center'">
                            <div @click="toggleExpand('regions')" class="cursor-pointer flex items-center gap-1 mr-2 px-1 py-1 rounded hover:bg-slate-100 transition-colors select-none">
                                <span class="text-xs font-black text-slate-400 uppercase w-12 shrink-0">ğŸ“ åŒºåŸŸ</span>
                                <span class="text-[8px] text-slate-400" x-text="expanded.regions ? 'â–²' : 'â–¼'"></span>
                            </div>
                            <button @click="activeRegions = []; currentPage = 1" :class="activeRegions.length === 0 ? 'btn-active-primary' : 'bg-white text-slate-600 hover:border-sky-400'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm">å…¨éƒ¨</button>
                            <template x-for="region in regions" :key="region">
                                <button @click="toggleFilter('activeRegions', region)" :class="activeRegions.includes(region) ? 'btn-active-primary' : 'bg-white text-slate-600 hover:border-sky-400'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm" x-text="region"></button>
                            </template>
                        </div>
                    </div>

                    <div class="border-t border-dashed border-slate-300/50 pt-2 overflow-x-auto hide-scroll pb-2" :class="expanded.tags ? 'overflow-visible' : 'overflow-x-auto hide-scroll'">
                        <div :class="expanded.tags ? 'flex flex-wrap gap-2 items-center' : 'flex space-x-2 min-w-max items-center'">
                             <div @click="toggleExpand('tags')" class="cursor-pointer flex items-center gap-1 mr-2 px-1 py-1 rounded hover:bg-slate-100 transition-colors select-none">
                                <span class="text-xs font-black text-slate-400 uppercase w-12 shrink-0">ğŸ·ï¸ ç­›é€‰</span>
                                <span class="text-[8px] text-slate-400" x-text="expanded.tags ? 'â–²' : 'â–¼'"></span>
                            </div>
                            
                            <button @click="toggleTag('indoor')" :class="activeTags.includes('indoor') ? 'bg-indigo-500 text-white' : 'bg-white text-slate-600 hover:text-indigo-500'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">ğŸ›ï¸ å®¤å†…</button>
                            
                            <button @click="toggleTag('pet')" :class="activeTags.includes('pet') ? 'bg-orange-400 text-white' : 'bg-white text-slate-600 hover:text-orange-500'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">ğŸ¶ å® ç‰©å‹å¥½</button>
                            <button @click="toggleTag('family')" :class="activeTags.includes('family') ? 'bg-pink-400 text-white' : 'bg-white text-slate-600 hover:text-pink-500'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ é€‚åˆå®¶åº­</button>
                            <button @click="toggleTag('free')" :class="activeTags.includes('free') ? 'bg-emerald-500 text-white' : 'bg-white text-slate-600 hover:text-emerald-500'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">ğŸ†“ å…è´¹</button>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-center py-2 cursor-pointer select-none border-t border-dashed border-slate-300/50 mt-2" @click="showFilters = !showFilters">
                    <span class="text-xs font-black text-slate-500 uppercase tracking-wider flex items-center gap-2">
                        <span>ç­›é€‰æ¡ä»¶</span>
                        <span x-show="!showFilters && (activeRegions.length + activeCategories.length + activeTags.length + activePopularity.length + activeDistances.length) > 0" 
                              class="bg-sky-600 text-white px-2 py-0.5 rounded-full text-[10px] font-bold" x-cloak>
                             å·²é€‰ <span x-text="activeRegions.length + activeCategories.length + activeTags.length + activePopularity.length + activeDistances.length"></span>
                        </span>
                    </span>
                    <button class="text-xs font-bold text-slate-600 hover:text-black flex items-center gap-1 transition-colors">
                        <span x-text="showFilters ? 'æ”¶èµ·' : 'å±•å¼€'"></span>
                        <span class="transform transition-transform duration-300" :class="showFilters ? 'rotate-180' : ''">â–¼</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div x-show="showModal" class="fixed inset-0 z-50 flex items-center justify-center px-4" x-cloak>
        <div class="absolute inset-0 bg-slate-900/70 backdrop-blur-sm" @click="showModal = false" x-transition.opacity></div>
        
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md relative z-10 overflow-hidden flex flex-col h-[580px]" 
             x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100">
            
            <button @click="showModal = false" class="absolute top-3 right-3 z-30 w-8 h-8 flex items-center justify-center rounded-full bg-black/40 text-white backdrop-blur-md hover:bg-black transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>

            <div class="w-full h-56 shrink-0 relative bg-slate-100 group">
                <template x-if="modalData?.images && modalData.images.length > 0">
                    <div class="w-full h-full relative">
                        <template x-for="(img, index) in modalData.images" :key="index">
                            <div x-show="activeImgIndex === index" 
                                    x-transition:enter="transition ease-out duration-300"
                                    x-transition:enter-start="opacity-0"
                                    x-transition:enter-end="opacity-100"
                                    class="absolute inset-0 w-full h-full bg-black">
                                <img :src="resizeImg(img, 800)" class="w-full h-full object-cover" alt="Place Image">
                            </div>
                        </template>
                        
                        <button x-show="modalData.images.length > 1"
                                @click.stop="prevImg()" 
                                class="absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full bg-black/30 text-white backdrop-blur-sm hover:bg-black/60 transition-colors z-30">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                        </button>

                        <button x-show="modalData.images.length > 1"
                                @click.stop="nextImg()"
                                class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full bg-black/30 text-white backdrop-blur-sm hover:bg-black/60 transition-colors z-30">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>

                        <div x-show="modalData.images.length > 1" class="absolute bottom-6 left-1/2 -translate-x-1/2 flex space-x-1.5 z-20">
                            <template x-for="(img, index) in modalData.images" :key="index">
                                <div class="w-1.5 h-1.5 rounded-full transition-colors duration-300 shadow-sm" 
                                     :class="activeImgIndex === index ? 'bg-white scale-125' : 'bg-white/40'"></div>
                            </template>
                        </div>
                    </div>
                </template>
                
                <div class="absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-white via-white/70 to-transparent z-10 pointer-events-none"></div>

                <div class="absolute top-3 left-3 z-20 flex flex-wrap gap-1 max-w-[80%]">
                    <span x-show="modalData?.popularLevel == 3" class="text-[10px] font-black px-2 py-1 rounded bg-red-500 text-white shrink-0 shadow-sm">ğŸš© æ‰“å¡åœ°æ ‡</span>
                    <span x-show="modalData?.popularLevel == 2" class="text-[10px] font-black px-2 py-1 rounded bg-blue-500 text-white shrink-0 shadow-sm">ğŸŒŸ æ‡‚è¡Œä¹‹é€‰</span>
                    <span x-show="modalData?.popularLevel == 1" class="text-[10px] font-black px-2 py-1 rounded bg-purple-500 text-white shrink-0 shadow-sm">ğŸ’ ç§è—å†·é—¨</span>
                    </div>
            </div>

            <div class="p-6 pt-2 flex-1 flex flex-col items-center text-center -mt-8 relative z-20 overflow-hidden w-full">
                <div x-show="modalData" class="w-full flex flex-col items-center h-full">
                    
                    <h2 class="text-2xl md:text-3xl font-black text-slate-900 leading-tight shrink-0 px-2 line-clamp-2 drop-shadow-sm" x-text="modalData?.name"></h2>
                    
                    <p x-show="modalData?.chineseName" class="text-sm text-slate-400 font-bold mt-1 mb-2 tracking-wide" x-text="modalData?.chineseName"></p>

                    <div class="flex justify-center gap-2 mb-2 w-full shrink-0">
                        <span class="text-[10px] font-black uppercase px-2 py-1 rounded bg-slate-100 text-slate-800 shrink-0 border border-slate-200" x-text="modalData?.region"></span>
                        <span class="text-[10px] font-black px-2 py-1 rounded bg-teal-50 text-teal-800 shrink-0 border border-teal-100" x-text="modalData?.category"></span>
                    </div>

                    <div class="flex flex-wrap justify-center gap-2 mb-4 overflow-x-auto hide-scroll px-4 w-full shrink-0">
                        <span x-show="modalData?.distance > 0" class="text-[10px] font-black px-2 py-1 rounded bg-slate-200 text-slate-600 shrink-0 shadow-sm" x-text="'ğŸš— ' + modalData?.distance + 'km'"></span>

                        <span x-show="modalData?.isIndoor" class="text-[10px] font-bold text-indigo-600 bg-indigo-50 px-2 py-1 rounded border border-indigo-100">ğŸ›ï¸ å®¤å†…</span>

                        <span x-show="modalData?.isPetFriendly" class="text-[10px] font-bold text-orange-600 bg-orange-50 px-2 py-1 rounded border border-orange-100">ğŸ¶ å® ç‰©å‹å¥½</span>
                        <span x-show="modalData?.isFamilyFriendly" class="text-[10px] font-bold text-pink-600 bg-pink-50 px-2 py-1 rounded border border-pink-100">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ äº²å­</span>
                        <span x-show="modalData?.isFree" class="text-[10px] font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded border border-emerald-100">ğŸ†“ å…è´¹</span>
                    </div>

                    <div class="w-full px-4 mb-4 overflow-y-auto text-sm text-slate-600 leading-relaxed font-medium">
                         <p x-text="modalData?.descDetail"></p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-5 border-t border-slate-100 bg-slate-50 shrink-0 py-3 items-center text-center h-[72px]">
                
                <button @click="reportError(modalData?.id)" 
                    :disabled="isReporting"
                    class="flex flex-col items-center justify-center py-2 hover:bg-red-50 hover:text-red-600 transition-colors group disabled:opacity-50 disabled:cursor-not-allowed mx-1 rounded-lg">
                    <span class="text-xl mb-1 group-hover:scale-110 transition-transform" x-text="isReporting ? 'â³' : 'âš ï¸'"></span>
                    <span class="text-[10px] font-bold text-slate-500 group-hover:text-red-600" x-text="reportText">æŠ¥é”™</span>
                </button>
                
                <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(modalData?.name + ' ' + modalData?.region + ' Sydney')" 
                   target="_blank" class="flex flex-col items-center justify-center py-2 hover:bg-sky-50 hover:text-sky-600 transition-colors group mx-1 rounded-lg">
                    <span class="text-xl mb-1 group-hover:-translate-y-1 transition-transform">ğŸ“</span>
                    <span class="text-[10px] font-bold text-slate-900 group-hover:text-sky-600">å¯¼èˆª</span>
                </a>

                <button @click="pickRandom()" class="w-full flex flex-col items-center justify-center bg-slate-900 text-white shadow-lg hover:bg-slate-800 hover:shadow-xl active:scale-95 px-2 py-2 rounded-xl text-sm font-medium transition-all duration-300 transform hover:-translate-y-0.5 mx-auto h-12 max-w-[64px]">
                    <span class="text-xl mb-1 leading-none">ğŸ²</span>
                    <span class="text-[10px] font-medium tracking-widest leading-none">æ¢</span>
                </button>
                
                <button @click="copyKeyword(modalData?.name)" class="flex flex-col items-center justify-center py-2 hover:bg-purple-50 hover:text-purple-600 transition-colors group mx-1 rounded-lg">
                    <span class="text-xl mb-1 group-hover:-translate-y-1 transition-transform">ğŸ“•</span>
                    <span class="text-[10px] font-bold text-slate-500 group-hover:text-purple-600">å¤åˆ¶</span>
                </button>

                <button @click="sharePlace(modalData)" class="flex flex-col items-center justify-center py-2 hover:bg-blue-50 hover:text-blue-600 transition-colors group mx-1 rounded-lg">
                    <span class="text-xl mb-1 group-hover:-translate-y-1 transition-transform">ğŸ“¤</span>
                    <span class="text-[10px] font-bold text-slate-500 group-hover:text-blue-600">åˆ†äº«</span>
                </button>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 min-h-screen">
        <div class="flex justify-between items-end mb-6 px-1 border-b border-black/5 pb-2">
            <span class="text-sm text-slate-700 font-bold bg-white/50 px-2 py-1 rounded-md">
                å…± <strong x-text="filteredPlaces.length" class="text-slate-900 text-lg"></strong> ä¸ªå¥½å»å¤„
                <span x-show="places.length === 0" class="text-sky-600 ml-2 animate-pulse">(æ•°æ®åŠ è½½ä¸­...)</span>
            </span>
            <span x-show="filteredPlaces.length > 0" class="text-xs text-slate-700 font-bold bg-white/50 px-2 py-1 rounded-md">
                ç¬¬ <span x-text="currentPage"></span> / <span x-text="totalPages"></span> é¡µ
            </span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <template x-for="p in paginatedPlaces" :key="p.id">
                <div @click="openModal(p)" class="group bg-white rounded-3xl shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden flex flex-col h-full cursor-pointer relative ring-1 ring-slate-100">
                    <div class="h-48 w-full bg-slate-100 relative overflow-hidden shrink-0">
                         <img :src="resizeImg(p.images[0], 400)" 
                              class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" 
                              loading="lazy" alt="Place">
                         
                         <div class="absolute top-3 left-3 z-10 flex flex-wrap gap-1 max-w-[85%]">
                            <span x-show="p.popularLevel == 3" class="bg-red-500 text-white text-[10px] font-black px-2 py-1 rounded-full shadow-md flex items-center gap-1 tracking-wide">ğŸš© æ‰“å¡åœ°æ ‡</span>
                            <span x-show="p.popularLevel == 2" class="bg-blue-500 text-white text-[10px] font-black px-2 py-1 rounded-full shadow-md flex items-center gap-1 tracking-wide">ğŸŒŸ æ‡‚è¡Œä¹‹é€‰</span>
                            <span x-show="p.popularLevel == 1" class="bg-purple-500 text-white text-[10px] font-black px-2 py-1 rounded-full shadow-md flex items-center gap-1 tracking-wide">ğŸ’ ç§è—å†·é—¨</span>
                            </div>
                         
                         <div x-show="p.images.length > 1" class="absolute top-3 right-3 z-10">
                             <span class="bg-black/50 backdrop-blur text-white text-[10px] font-bold px-2 py-1 rounded-full flex items-center gap-1">
                                 ğŸ“· <span x-text="p.images.length"></span>
                             </span>
                         </div>
                    </div>

                    <div class="p-5 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-black uppercase tracking-wider text-sky-600" x-text="p.region"></span>
                            <span class="text-[10px] font-bold text-slate-400" x-text="p.category"></span>
                        </div>
                        <h3 class="text-xl font-black text-slate-800 leading-tight mb-2 group-hover:text-sky-600 transition-colors" x-text="p.name"></h3>
                        <p class="text-slate-500 text-sm mb-4 leading-relaxed line-clamp-2" x-text="p.desc"></p>
                        
                        <div class="mt-auto pt-3 border-t border-slate-50 flex items-center justify-between gap-2">
                            
                            <div class="flex items-center gap-1 overflow-x-auto hide-scroll no-scrollbar mask-image-fading">
                                <span x-show="p.distance > 0" class="text-[10px] font-black px-1.5 py-0.5 rounded bg-slate-100 text-slate-600 whitespace-nowrap" x-text="'ğŸš— ' + p.distance + 'km'"></span>

                                <span x-show="p.isIndoor" class="text-[10px] text-indigo-600 bg-indigo-50 px-1.5 py-0.5 rounded border border-indigo-100 font-bold whitespace-nowrap">å®¤å†…</span>

                                <span x-show="p.isFamilyFriendly" class="text-[10px] text-pink-600 bg-pink-50 px-1.5 py-0.5 rounded border border-pink-100 font-bold whitespace-nowrap">äº²å­</span>
                                <span x-show="p.isPetFriendly" class="text-[10px] text-orange-600 bg-orange-50 px-1.5 py-0.5 rounded border border-orange-100 font-bold whitespace-nowrap">å® ç‰©</span>
                                <span x-show="p.isFree" class="text-[10px] text-emerald-600 bg-emerald-50 px-1.5 py-0.5 rounded border border-emerald-100 font-bold whitespace-nowrap">å…è´¹</span>
                            </div>
                            
                            <div class="flex items-center gap-2 shrink-0">
                                <button @click.stop="copyKeyword(p.name)" 
                                        class="text-[10px] text-slate-400 bg-slate-50 hover:bg-purple-50 hover:text-purple-600 border border-slate-100 hover:border-purple-100 px-2 py-1 rounded transition-all whitespace-nowrap font-bold flex items-center gap-1">
                                    ğŸ“•
                                </button>
                                
                                <button @click.stop="reportError(p.id)" 
                                        class="text-[10px] text-slate-400 bg-slate-50 hover:bg-red-50 hover:text-red-600 border border-slate-100 hover:border-red-100 px-2 py-1 rounded transition-all whitespace-nowrap font-bold flex items-center gap-1">
                                    âš ï¸
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
        
        <div x-show="filteredPlaces.length === 0 && places.length > 0" class="text-center py-20" x-cloak>
            <p class="text-slate-500 font-bold bg-white/50 inline-block px-4 py-2 rounded-full backdrop-blur-sm">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„åœ°æ–¹ï¼Œè¯·å°è¯•è°ƒæ•´ç­›é€‰...</p>
        </div>

        <div x-show="totalPages > 1" class="flex justify-center items-center gap-4 mt-12 mb-6">
            <button @click="changePage(currentPage - 1)" :disabled="currentPage === 1" class="px-4 py-2 text-sm font-bold rounded-xl bg-white hover:bg-sky-50 text-slate-800 disabled:opacity-50 shadow-sm transition-colors">â† ä¸Šä¸€é¡µ</button>
            <span class="text-sm font-bold text-slate-500"><span x-text="currentPage"></span> / <span x-text="totalPages"></span></span>
            <button @click="changePage(currentPage + 1)" :disabled="currentPage === totalPages" class="px-4 py-2 text-sm font-bold rounded-xl bg-white hover:bg-sky-50 text-slate-800 disabled:opacity-50 shadow-sm transition-colors">ä¸‹ä¸€é¡µ â†’</button>
        </div>
    </main>

    <div x-show="showToast" 
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 translate-y-4"
        class="fixed bottom-10 left-1/2 transform -translate-x-1/2 z-[60] bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 pointer-events-none border border-slate-700"
        x-cloak>
        <span class="text-lg">âœ…</span>
        <div class="flex flex-col">
            <span class="text-sm font-bold" x-text="toastMessage"></span>
        </div>
    </div>

    <script>
        function placesApp() {
            return {
                GAS_URL: 'https://script.google.com/macros/s/AKfycbyuafm1c36P2TpXBRInGPQh_4VdRq-zuNfyUmEE6ndqpv-EEf_805yvdUdfp_vHZjnGVw/exec',

                places: [],
                search: '',
                currentPage: 1,
                itemsPerPage: 18,
                
                showFilters: true,
                expanded: { regions: false, cats: false, pop: false, dist: false, tags: false }, // ç§»é™¤äº† env
                
                showModal: false,
                modalData: null,
                activeImgIndex: 0,
                isRandomPick: false,
                
                isShuffleMode: false,
                shuffledList: [],
                
                showToast: false,
                toastMessage: '',
                
                isReporting: false,
                reportText: 'æŠ¥é”™',

                // ç§»é™¤äº† envFilter
                activeRegions: [],
                activeCategories: [],
                activeTags: [], 
                activePopularity: [], 
                activeDistances: [], 
                
                regions: [],
                categories: [],

                categoryMap: {
                    1: 'åœ°æ ‡ä¸è§‚æ™¯',
                    2: 'è‡ªç„¶ä¸å…¬å›­',
                    3: 'å†å²ä¸æ–‡åŒ–',
                    4: 'å¨±ä¹ä¸ä½“è‚²',
                    5: 'ç¾é£Ÿä¸é¤é¥®',
                    6: 'æµ·æ»©ä¸æ³³æ± ',
                    7: 'å¾’æ­¥ä¸æ¢é™©',
                    8: 'è´­ç‰©ä¸é›†å¸‚',
                    9: 'åŠ¨ç‰©ä¸å†œåœº',
                    10: 'åŸé•‡ä¸ä¸€æ—¥æ¸¸'
                },

                defaultImages: {
                    'åœ°æ ‡ä¸è§‚æ™¯': 'https://images.unsplash.com/photo-1506953823976-52e1fdc0149b?w=800&q=80',
                    'è‡ªç„¶ä¸å…¬å›­': 'https://images.unsplash.com/photo-1596238836024-4f518e38484f?w=800&q=80',
                    'å†å²ä¸æ–‡åŒ–': 'https://images.unsplash.com/photo-1566127444979-b3d2b654e3d7?w=800&q=80',
                    'å¨±ä¹ä¸ä½“è‚²': 'https://images.unsplash.com/photo-1517466787929-bc90951d0974?w=800&q=80',
                    'ç¾é£Ÿä¸é¤é¥®': 'https://images.unsplash.com/photo-1559339352-11d035aa65de?w=800&q=80',
                    'æµ·æ»©ä¸æ³³æ± ': 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800&q=80',
                    'å¾’æ­¥ä¸æ¢é™©': 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=800&q=80',
                    'è´­ç‰©ä¸é›†å¸‚': 'https://images.unsplash.com/photo-1483985988355-763728e1935b?w=800&q=80',
                    'åŠ¨ç‰©ä¸å†œåœº': 'https://images.unsplash.com/photo-1541781777631-fa95371aad95?w=800&q=80',
                    'åŸé•‡ä¸ä¸€æ—¥æ¸¸': 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=800&q=80',
                    'Other': 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=800&q=80'
                },

                init() {
                    const sheetId = '1S4j1zUw3kl_UKvNNEq7luAApIIaU---L2KRZDTWVkuY';
                    const sheetName = 'Sheet1'; 
                    
                    fetch(`https://opensheet.elk.sh/${sheetId}/${sheetName}`)
                        .then(res => {
                            if (!res.ok) throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                            return res.json();
                        })
                        .then(data => {
                            if(data.error) {
                                alert('è¯»å–å¤±è´¥ï¼šè¯·æ£€æŸ¥è¡¨æ ¼æ˜¯å¦å…¬å¼€');
                                return;
                            }
                            this.processData(data);
                        })
                        .catch(err => {
                            console.error("åŠ è½½é”™è¯¯", err);
                            alert("æ— æ³•è¿æ¥åˆ° Google Sheet");
                        });
                },

                resizeImg(url, width = 400) {
                    if (!url) return '';
                    if (url.includes('images.unsplash.com')) return url;
                    return `https://images.weserv.nl/?url=${encodeURIComponent(url)}&w=${width}&q=80&output=webp`;
                },

                processData(data) {
                    this.places = data.map((row, index) => {
                        const catId = parseInt(row.category);
                        let cat = this.categoryMap[catId] || 'å…¶ä»–';
                        
                        if (!this.categoryMap[catId] && row.category) {
                             cat = row.category.trim();
                        }

                        let imgArray = [];
                        if (row.image && typeof row.image === 'string') {
                            const separatorRegex = /\|{2,}|%7C{2,}|\n/g;
                            imgArray = row.image.split(separatorRegex)
                                .map(s => {
                                    s = s.trim();
                                    if (s.match(/^http%3A/i) || s.includes('%3A%2F%2F')) {
                                         try { return decodeURIComponent(s); } catch(e) { return s; }
                                    }
                                    return s;
                                })
                                .filter(s => s.startsWith('http'));
                        }
                        
                        if (imgArray.length === 0) {
                            imgArray = [this.defaultImages[cat] || this.defaultImages['Other']];
                        }

                        return {
                            id: row.id || ('place_' + index),
                            name: row.name || 'æœªå‘½å',
                            chineseName: row.chinese_name ? row.chinese_name.trim() : '', 
                            region: row.region || 'Sydney',
                            category: cat,
                            // ä¿®æ”¹ï¼šå°† environment è½¬æ¢ä¸º isIndoor å¸ƒå°”å€¼
                            isIndoor: row.environment && row.environment.toLowerCase() === 'indoor',
                            
                            popularLevel: parseInt(row.popular) || 0,
                            distance: parseFloat(row.distance) || 0,

                            isFree: String(row.isFree).toUpperCase() === 'TRUE',
                            isPetFriendly: String(row.isPetFriendly).toUpperCase() === 'TRUE',
                            isFamilyFriendly: String(row.isFamilyFriendly).toUpperCase() === 'TRUE',
                            
                            // ä¿®æ”¹éƒ¨åˆ†ï¼šåˆ—è¡¨ç”¨ descï¼Œå¼¹çª—ç”¨ descDetail (description_detail)
                            desc: row.desc || 'æš‚æ— æè¿°',
                            descDetail: row.description_detail || row.desc || 'æš‚æ— æè¿°',
                            
                            images: imgArray 
                        };
                    });

                    this.regions = [...new Set(this.places.map(p => p.region))].filter(Boolean).sort();
                    this.categories = [...new Set(this.places.map(p => p.category))].filter(Boolean).sort();
                },

                triggerToast(msg) {
                    this.toastMessage = msg;
                    this.showToast = true;
                    setTimeout(() => { this.showToast = false; }, 2000);
                },

                copyKeyword(name) {
                    if (!name) return;
                    const text = `æ‚‰å°¼ ${name}`;
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(text).then(() => {
                            this.triggerToast(`å·²å¤åˆ¶ "${text}"ï¼Œå»æœå°çº¢ä¹¦å§ï¼`);
                        }).catch(err => prompt("è¯·æ‰‹åŠ¨å¤åˆ¶æœç´¢è¯ï¼š", text));
                    } else {
                        prompt("è¯·æ‰‹åŠ¨å¤åˆ¶æœç´¢è¯ï¼š", text);
                    }
                },
                
                async reportError(id) {
                    if (!id || this.isReporting) return;
                    if (!confirm("ç¡®å®šè¦åé¦ˆæ­¤åœ°ç‚¹ä¿¡æ¯æœ‰è¯¯å—ï¼Ÿ")) return;
                    
                    this.isReporting = true;
                    this.reportText = '...';
                    
                    try {
                        await fetch(this.GAS_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ id: id, type: 'place_error' })
                        });
                        this.triggerToast('å·²æäº¤åé¦ˆï¼Œè°¢è°¢ï¼');
                    } catch (error) {
                        console.error("æŠ¥é”™å¤±è´¥", error);
                        alert("æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ");
                    } finally {
                        this.isReporting = false;
                        this.reportText = 'æŠ¥é”™';
                    }
                },

                sharePlace(p) {
                    if (!p) return;
                    let text = `å‘¨æœ«å»å“ªé‡Œï¼Ÿ\nâœ¨ ${p.name}`;
                    if(p.chineseName) text += ` (${p.chineseName})`;
                    
                    if(p.popularLevel == 3) text += `\nğŸš© æ‰“å¡åœ°æ ‡`;
                    if(p.distance > 0) text += `\nğŸš— è·ç¦»: ${p.distance}km`;
                    
                    text += `\nğŸ“ ${p.region}\nğŸ’¬ ${p.desc}`;
                    
                    const url = `https://www.google.com/maps/search/?api=1&query=` + encodeURIComponent(p.name + ' ' + p.region + ' Sydney');
                    const fullText = `${text}\nğŸ”— å¯¼èˆª: ${url}`;
                    
                    if (navigator.share) {
                         navigator.share({
                            title: p.name,
                            text: fullText,
                            url: window.location.href
                        }).catch(console.error);
                    } else {
                        navigator.clipboard.writeText(fullText).then(() => {
                            this.triggerToast('ä¿¡æ¯å·²å¤åˆ¶ï¼Œå¿«å‘ç»™æœ‹å‹å§ï¼');
                        });
                    }
                },

                shareApp() {
                    if (navigator.share) {
                        navigator.share({
                            title: 'æ‚‰å°¼å»å“ªé‡Œ | Sydney Places Guide',
                            text: 'å‘¨æœ«ä¸çŸ¥é“å»å“ªç©ï¼Ÿç”¨è¿™ä¸ªé€‰ä¸€ä¸‹ï¼',
                            url: window.location.href
                        });
                    } else {
                        navigator.clipboard.writeText(window.location.href);
                        this.triggerToast('é“¾æ¥å·²å¤åˆ¶ï¼Œå¿«å‘ç»™æœ‹å‹ï¼');
                    }
                },

                toggleFilter(arr, val) {
                    if (this[arr].includes(val)) this[arr] = this[arr].filter(x => x !== val);
                    else this[arr].push(val);
                    this.currentPage = 1;
                    this.isShuffleMode = false;
                },
                toggleTag(tag) {
                    if (this.activeTags.includes(tag)) this.activeTags = this.activeTags.filter(t => t !== tag);
                    else this.activeTags.push(tag);
                    this.currentPage = 1;
                    this.isShuffleMode = false;
                },
                toggleExpand(section) {
                    this.expanded[section] = !this.expanded[section];
                },

                shuffleView() {
                    let list = [...this.filteredPlaces];
                    for (let i = list.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [list[i], list[j]] = [list[j], list[i]];
                    }
                    this.shuffledList = list;
                    this.isShuffleMode = true;
                    this.currentPage = 1;
                    window.scrollTo({top: 0, behavior: 'smooth'});
                },

                get filteredPlaces() {
                    return this.places.filter(p => {
                        const q = this.search.toLowerCase();
                        const matchSearch = p.name.toLowerCase().includes(q) || 
                                            p.chineseName.toLowerCase().includes(q) || 
                                            p.region.toLowerCase().includes(q) || 
                                            p.category.toLowerCase().includes(q) || 
                                            p.desc.toLowerCase().includes(q);
                        
                        // ç§»é™¤äº† matchEnv
                        const matchRegion = this.activeRegions.length === 0 || this.activeRegions.includes(p.region);
                        const matchCat = this.activeCategories.length === 0 || this.activeCategories.includes(p.category);
                        const matchPop = this.activePopularity.length === 0 || this.activePopularity.includes(p.popularLevel);

                        // 4çº§è·ç¦»ç­›é€‰é€»è¾‘
                        let matchDist = true;
                        if (this.activeDistances.length > 0) {
                            matchDist = false; 
                            if (this.activeDistances.includes('walk') && p.distance < 3) matchDist = true;
                            if (this.activeDistances.includes('close') && p.distance >= 3 && p.distance < 10) matchDist = true;
                            if (this.activeDistances.includes('mid') && p.distance >= 10 && p.distance <= 40) matchDist = true;
                            if (this.activeDistances.includes('far') && p.distance > 40) matchDist = true;
                        }

                        let matchTags = true;
                        // æ–°å¢ï¼šå®¤å†…ç­›é€‰é€»è¾‘
                        if (this.activeTags.includes('indoor') && !p.isIndoor) matchTags = false;
                        
                        if (this.activeTags.includes('pet') && !p.isPetFriendly) matchTags = false;
                        if (this.activeTags.includes('family') && !p.isFamilyFriendly) matchTags = false;
                        if (this.activeTags.includes('free') && !p.isFree) matchTags = false;
                        
                        return matchSearch && matchRegion && matchCat && matchTags && matchPop && matchDist;
                    });
                },
                get paginatedPlaces() {
                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    const source = this.isShuffleMode ? this.shuffledList : this.filteredPlaces;
                    return source.slice(start, start + this.itemsPerPage);
                },
                get totalPages() {
                    const source = this.isShuffleMode ? this.shuffledList : this.filteredPlaces;
                    return Math.ceil(source.length / this.itemsPerPage);
                },
                changePage(page) {
                    this.currentPage = page;
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },

                openModal(place) {
                    this.modalData = place;
                    this.activeImgIndex = 0; 
                    this.isRandomPick = false;
                    this.showModal = true;
                },
                nextImg() {
                    if (!this.modalData) return;
                    const len = this.modalData.images.length;
                    this.activeImgIndex = (this.activeImgIndex + 1) % len;
                },
                prevImg() {
                    if (!this.modalData) return;
                    const len = this.modalData.images.length;
                    this.activeImgIndex = (this.activeImgIndex - 1 + len) % len;
                },
                
                pickRandom() {
                    const pool = this.filteredPlaces;
                    if (pool.length === 0) {
                        alert('å½“å‰ç­›é€‰ä¸‹æ²¡æœ‰åœ°æ–¹å¯å»ï¼Œæ¢ä¸ªæ¡ä»¶è¯•è¯•ï¼Ÿ');
                        return;
                    }
                    const random = pool[Math.floor(Math.random() * pool.length)];
                    this.modalData = random;
                    this.activeImgIndex = 0;
                    this.isRandomPick = true;
                    this.showModal = true;
                }
            }
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‚‰å°¼å»å“ªé‡Œ | Sydney Places Guide</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        [x-cloak] { display: none !important; }
        
        .glass-effect { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }
        .btn-transition { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-active-primary {
            background-color: #0ea5e9 !important;
            color: #fff !important;
            border-color: #0ea5e9 !important;
            box-shadow: 0 4px 6px -1px rgba(14, 165, 233, 0.3);
        }
        .bg-nature {
            background-color: #E0F2F1;
            background-image: linear-gradient(135deg, #E0F2F1 0%, #B2EBF2 50%, #BBDEFB 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="bg-nature text-slate-800 antialiased" x-data="placesApp()">

    <header class="glass-effect sticky top-0 z-40 transition-all duration-300 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-2">
                <div class="text-center md:text-left">
                    <h1 class="text-2xl font-black text-slate-900 tracking-tight flex items-center gap-2 justify-center md:justify-start">
                        <span>ğŸŒŠ</span> æ‚‰å°¼å»å“ªé‡Œ <span class="text-sky-600">Sydney</span>
                    </h1>
                    <p class="text-xs text-slate-500 font-bold tracking-wide uppercase mt-1">å‘¨æœ«ä¸æ— èŠ Â· æ‚‰å°¼æ¸¸ç©æŒ‡å—</p>
                </div>
                
                <div class="flex gap-3 w-full md:w-auto">
                    <div class="relative flex-grow md:flex-grow-0 md:w-64 group">
                        <input x-model="search" @input="currentPage = 1" type="text" placeholder="ğŸ” æœæ™¯ç‚¹ã€åŒºåŸŸã€ç©æ³•..." 
                            class="w-full pl-4 pr-4 py-2.5 rounded-2xl border-2 border-white/50 bg-white/80 focus:border-sky-400 focus:ring-0 outline-none text-sm font-medium transition-all shadow-sm hover:bg-white placeholder-slate-400">
                    </div>
                    
                    <button @click="pickRandom()" 
                        class="bg-slate-900 hover:bg-sky-600 text-white border-2 border-transparent px-5 py-2 rounded-2xl text-sm font-bold shadow-lg hover:shadow-sky-500/30 transition-all duration-300 flex items-center gap-2 whitespace-nowrap transform hover:-translate-y-0.5">
                        <span>ğŸ²</span> <span>å¸®æˆ‘é€‰</span>
                    </button>
                </div>
            </div>

            <div class="pb-1">
                <div x-show="showFilters" x-collapse class="space-y-3 pt-2">
                    <div class="flex items-center space-x-2 overflow-x-auto hide-scroll pb-1">
                        <span class="text-xs font-black text-slate-400 uppercase w-12 shrink-0">ğŸŒ¤ï¸ ç¯å¢ƒ</span>
                        <button @click="envFilter = 'all'" :class="envFilter === 'all' ? 'bg-slate-800 text-white' : 'bg-white text-slate-600 hover:text-sky-600'" class="px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm transition-colors">å…¨éƒ¨</button>
                        <button @click="envFilter = 'outdoor'" :class="envFilter === 'outdoor' ? 'bg-green-500 text-white' : 'bg-white text-slate-600 hover:text-green-600'" class="px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm transition-colors">ğŸŒ³ æˆ·å¤–/æ™´å¤©</button>
                        <button @click="envFilter = 'indoor'" :class="envFilter === 'indoor' ? 'bg-indigo-500 text-white' : 'bg-white text-slate-600 hover:text-indigo-600'" class="px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm transition-colors">ğŸ›ï¸ å®¤å†…/é›¨å¤©</button>
                    </div>

                    <div class="border-t border-dashed border-slate-300/50 pt-2 overflow-x-auto hide-scroll">
                        <div class="flex space-x-2 min-w-max items-center">
                            <span class="text-xs font-black text-slate-400 uppercase w-12 shrink-0">ğŸ“ åŒºåŸŸ</span>
                            <button @click="activeRegions = []" :class="activeRegions.length === 0 ? 'btn-active-primary' : 'bg-white text-slate-600 hover:border-sky-400'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm">å…¨éƒ¨</button>
                            <template x-for="region in regions" :key="region">
                                <button @click="toggleFilter('activeRegions', region)" :class="activeRegions.includes(region) ? 'btn-active-primary' : 'bg-white text-slate-600 hover:border-sky-400'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm" x-text="region"></button>
                            </template>
                        </div>
                    </div>

                    <div class="border-t border-dashed border-slate-300/50 pt-2 overflow-x-auto hide-scroll">
                        <div class="flex space-x-2 min-w-max items-center">
                            <span class="text-xs font-black text-slate-400 uppercase w-12 shrink-0">ğŸ’ ç©æ³•</span>
                            <button @click="activeCategories = []" :class="activeCategories.length === 0 ? 'bg-teal-500 text-white' : 'bg-white text-slate-600 hover:text-teal-600'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm">å…¨éƒ¨</button>
                            <template x-for="cat in categories" :key="cat">
                                <button @click="toggleFilter('activeCategories', cat)" :class="activeCategories.includes(cat) ? 'bg-teal-500 text-white' : 'bg-white text-slate-600 hover:text-teal-600'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm" x-text="cat"></button>
                            </template>
                        </div>
                    </div>

                    <div class="border-t border-dashed border-slate-300/50 pt-2 overflow-x-auto hide-scroll">
                        <div class="flex space-x-2 min-w-max items-center">
                            <span class="text-xs font-black text-slate-400 uppercase w-12 shrink-0">ğŸ·ï¸ ç­›é€‰</span>
                            <button @click="toggleTag('pet')" :class="activeTags.includes('pet') ? 'bg-orange-400 text-white' : 'bg-white text-slate-600 hover:text-orange-500'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">ğŸ¶ å® ç‰©å‹å¥½</button>
                            <button @click="toggleTag('family')" :class="activeTags.includes('family') ? 'bg-pink-400 text-white' : 'bg-white text-slate-600 hover:text-pink-500'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ é€‚åˆå®¶åº­</button>
                            <button @click="toggleTag('free')" :class="activeTags.includes('free') ? 'bg-emerald-500 text-white' : 'bg-white text-slate-600 hover:text-emerald-500'" class="btn-transition px-3 py-1.5 rounded-lg text-xs font-bold border border-transparent shadow-sm flex items-center gap-1">ğŸ†“ å…è´¹</button>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center items-center pt-2 cursor-pointer select-none" @click="showFilters = !showFilters">
                    <div class="bg-white/50 hover:bg-white px-4 py-1 rounded-full flex items-center gap-1 transition-colors backdrop-blur-sm">
                        <span class="text-[10px] font-bold text-slate-500" x-text="showFilters ? 'æ”¶èµ·ç­›é€‰' : 'å±•å¼€ç­›é€‰'"></span>
                        <span class="text-[10px] text-slate-500 transform transition-transform" :class="showFilters ? 'rotate-180' : ''">â–¼</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 min-h-screen">
        <div class="flex justify-between items-end mb-6 px-1">
            <span class="text-sm text-slate-700 font-bold bg-white/50 px-2 py-1 rounded">
                å…± <strong x-text="filteredPlaces.length" class="text-slate-900 text-lg"></strong> ä¸ªå¥½å»å¤„
                <span x-show="places.length === 0" class="text-sky-600 ml-2 animate-pulse">(æ­£åœ¨è¯»å–ä½ çš„ Google Sheet...)</span>
            </span>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <template x-for="p in paginatedPlaces" :key="p.id">
                <div @click="openModal(p)" class="group bg-white rounded-3xl shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 overflow-hidden flex flex-col h-full cursor-pointer relative ring-1 ring-slate-100">
                    <div class="h-48 w-full bg-slate-100 relative overflow-hidden shrink-0">
                         <img :src="p.images[0]" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" loading="lazy" alt="Place">
                         <div class="absolute top-3 left-3 z-10">
                            <span x-show="p.environment === 'outdoor'" class="bg-white/90 backdrop-blur text-green-700 text-[10px] font-black uppercase px-2 py-1 rounded-full shadow-sm flex items-center gap-1">ğŸŒ³ æˆ·å¤–</span>
                            <span x-show="p.environment === 'indoor'" class="bg-white/90 backdrop-blur text-indigo-700 text-[10px] font-black uppercase px-2 py-1 rounded-full shadow-sm flex items-center gap-1">ğŸ›ï¸ å®¤å†…</span>
                         </div>
                         <div x-show="p.images.length > 1" class="absolute top-3 right-3 z-10">
                             <span class="bg-black/50 backdrop-blur text-white text-[10px] font-bold px-2 py-1 rounded-full flex items-center gap-1">
                                 ğŸ“· <span x-text="p.images.length"></span>
                             </span>
                         </div>
                         <div class="absolute bottom-2 left-2 flex gap-1 flex-wrap pr-2">
                             <span x-show="p.isPetFriendly" class="bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded backdrop-blur-md">ğŸ¶</span>
                             <span x-show="p.isFree" class="bg-emerald-600/80 text-white text-[10px] px-1.5 py-0.5 rounded backdrop-blur-md font-bold">FREE</span>
                         </div>
                    </div>
                    <div class="p-5 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-black uppercase tracking-wider text-sky-600" x-text="p.region"></span>
                            <span class="text-[10px] font-bold text-slate-400" x-text="p.category"></span>
                        </div>
                        <h3 class="text-xl font-black text-slate-800 leading-tight mb-2 group-hover:text-sky-600 transition-colors" x-text="p.name"></h3>
                        <p class="text-slate-500 text-sm mb-4 leading-relaxed line-clamp-2" x-text="p.desc"></p>
                        <div class="mt-auto pt-4 border-t border-slate-50 flex justify-between items-center">
                            <button class="text-xs font-bold text-slate-400 hover:text-sky-600 flex items-center gap-1 transition-colors">
                                <span>æŸ¥çœ‹è¯¦æƒ…</span>
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
        
        <div x-show="totalPages > 1" class="flex justify-center items-center gap-4 mt-12 mb-6">
            <button @click="changePage(currentPage - 1)" :disabled="currentPage === 1" class="px-4 py-2 text-sm font-bold rounded-xl bg-white hover:bg-slate-50 text-slate-800 disabled:opacity-50 shadow-sm transition-colors">â† ä¸Šä¸€é¡µ</button>
            <span class="text-sm font-bold text-slate-500"><span x-text="currentPage"></span> / <span x-text="totalPages"></span></span>
            <button @click="changePage(currentPage + 1)" :disabled="currentPage === totalPages" class="px-4 py-2 text-sm font-bold rounded-xl bg-white hover:bg-slate-50 text-slate-800 disabled:opacity-50 shadow-sm transition-colors">ä¸‹ä¸€é¡µ â†’</button>
        </div>
    </main>

    <div x-show="showModal" class="fixed inset-0 z-50 flex items-center justify-center px-4" x-cloak>
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" @click="showModal = false" x-transition.opacity></div>
        <div class="bg-white rounded-[2rem] shadow-2xl w-full max-w-md relative z-10 overflow-hidden flex flex-col max-h-[85vh]" 
             x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-8 scale-95" x-transition:enter-end="opacity-100 translate-y-0 scale-100">
            
            <div class="relative h-64 shrink-0 bg-slate-100 group">
                <button @click="showModal = false" class="absolute top-4 right-4 z-20 w-8 h-8 flex items-center justify-center rounded-full bg-black/30 text-white backdrop-blur hover:bg-black/50 transition-colors">âœ•</button>
                
                <template x-for="(img, index) in modalData?.images" :key="index">
                    <img :src="img" 
                         x-show="activeImgIndex === index" 
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 scale-105"
                         x-transition:enter-end="opacity-100 scale-100"
                         class="w-full h-full object-cover absolute inset-0">
                </template>

                <div x-show="modalData?.images.length > 1" class="absolute inset-0 flex items-center justify-between px-2 opacity-0 group-hover:opacity-100 transition-opacity z-10">
                    <button @click.stop="prevImg()" class="w-8 h-8 rounded-full bg-black/30 text-white backdrop-blur flex items-center justify-center hover:bg-black/50">â€¹</button>
                    <button @click.stop="nextImg()" class="w-8 h-8 rounded-full bg-black/30 text-white backdrop-blur flex items-center justify-center hover:bg-black/50">â€º</button>
                </div>
                
                <div x-show="modalData?.images.length > 1" class="absolute bottom-16 left-0 right-0 flex justify-center gap-1.5 z-10">
                    <template x-for="(_, index) in modalData?.images" :key="index">
                        <div class="w-1.5 h-1.5 rounded-full transition-all" 
                             :class="activeImgIndex === index ? 'bg-white w-3' : 'bg-white/50'"></div>
                    </template>
                </div>

                <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent pointer-events-none"></div>
                
                <div class="absolute bottom-4 left-6 text-white z-10">
                    <div class="flex items-center gap-2 mb-1">
                         <span class="px-2 py-0.5 rounded bg-sky-500/80 backdrop-blur text-[10px] font-bold uppercase" x-text="modalData?.category"></span>
                         <span x-show="modalData?.isFree" class="px-2 py-0.5 rounded bg-emerald-500/80 backdrop-blur text-[10px] font-bold uppercase">FREE</span>
                    </div>
                    <h2 class="text-3xl font-black leading-none shadow-black drop-shadow-md" x-text="modalData?.name"></h2>
                </div>
            </div>

            <div class="p-6 overflow-y-auto">
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded flex items-center gap-1">ğŸ“ <span x-text="modalData?.region"></span></span>
                    <span x-show="modalData?.isPetFriendly" class="text-xs font-bold text-orange-600 bg-orange-50 px-2 py-1 rounded">ğŸ¶ å® ç‰©å‹å¥½</span>
                    <span x-show="modalData?.isFamilyFriendly" class="text-xs font-bold text-pink-600 bg-pink-50 px-2 py-1 rounded">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ é€‚åˆå®¶åº­</span>
                </div>
                <p class="text-slate-600 text-base leading-relaxed mb-6 font-medium" x-text="modalData?.desc"></p>
                <div class="p-4 bg-slate-50 border-t border-slate-100 grid grid-cols-2 gap-3 shrink-0">
                    <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(modalData?.name + ' Sydney')" target="_blank"
                       class="flex items-center justify-center gap-2 bg-white border-2 border-slate-200 hover:border-sky-500 text-slate-700 hover:text-sky-600 py-3 rounded-xl font-bold transition-all text-sm group">
                        <span>ğŸ—ºï¸</span> å¯¼èˆªå‰å¾€
                    </a>
                    <button @click="sharePlace(modalData)" class="flex items-center justify-center gap-2 bg-slate-900 hover:bg-black text-white py-3 rounded-xl font-bold transition-all text-sm shadow-lg hover:shadow-xl hover:-translate-y-0.5">
                        <span>ğŸ“¤</span> åˆ†äº«
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function placesApp() {
            return {
                places: [],
                search: '',
                currentPage: 1,
                itemsPerPage: 18,
                showFilters: true,
                showModal: false,
                modalData: null,
                activeImgIndex: 0, 
                envFilter: 'all', 
                activeRegions: [],
                activeCategories: [],
                activeTags: [], 
                regions: [],
                categories: [],

                defaultImages: {
                    'Beach': 'https://images.unsplash.com/photo-1506953823976-52e1fdc0149b?w=800&q=80',
                    'Park': 'https://images.unsplash.com/photo-1596238836024-4f518e38484f?w=800&q=80',
                    'Hiking': 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=800&q=80',
                    'Museum': 'https://images.unsplash.com/photo-1566127444979-b3d2b654e3d7?w=800&q=80',
                    'Shopping': 'https://images.unsplash.com/photo-1483985988355-763728e1935b?w=800&q=80',
                    'Other': 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=800&q=80'
                },

                init() {
                    const sheetId = '1S4j1zUw3kl_UKvNNEq7luAApIIaU---L2KRZDTWVkuY';
                    const sheetName = 'Sheet1'; 
                    
                    fetch(`https://opensheet.elk.sh/${sheetId}/${sheetName}`)
                        .then(res => {
                            if (!res.ok) throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                            return res.json();
                        })
                        .then(data => {
                            if(data.error) {
                                alert('è¯»å–å¤±è´¥ï¼šè¯·æ£€æŸ¥è¡¨æ ¼æ˜¯å¦å…¬å¼€ï¼Œä¸”æ ‡ç­¾åæ˜¯å¦æ­£ç¡®');
                                return;
                            }
                            this.processData(data);
                        })
                        .catch(err => {
                            console.error("åŠ è½½é”™è¯¯", err);
                            alert("æ— æ³•è¿æ¥åˆ° Google Sheetï¼Œè¯·ç¡®ä¿è¡¨æ ¼å·²è®¾ç½®ä¸ºã€çŸ¥é“é“¾æ¥çš„äººå¯æŸ¥çœ‹ã€‘");
                        });
                },

                processData(data) {
                    this.places = data.map((row, index) => {
                        let cat = row.category ? row.category.trim() : 'Other';
                        let imgKey = 'Other';
                        if (cat.includes('Beach')) imgKey = 'Beach';
                        else if (cat.includes('Walk') || cat.includes('Hike')) imgKey = 'Hiking';
                        else if (cat.includes('Museum') || cat.includes('Gallery')) imgKey = 'Museum';
                        else if (cat.includes('Park') || cat.includes('Garden')) imgKey = 'Park';
                        else if (cat.includes('Shop')) imgKey = 'Shopping';

                        // === ä¿®å¤åçš„æ™ºèƒ½åˆ†å‰²ä¸æ¸…æ´— ===
                        let imgArray = [];
                        if (row.image && typeof row.image === 'string') {
                            // ä½¿ç”¨æ›´å®½æ¾çš„æ­£åˆ™ï¼šåŒ¹é…2ä¸ªåŠä»¥ä¸Šçš„ç«–çº¿ï¼Œæˆ–è€…URLç¼–ç çš„ç«–çº¿ï¼Œæˆ–è€…æ¢è¡Œç¬¦
                            const separatorRegex = /\|{2,}|%7C{2,}|\n/g;
                            
                            imgArray = row.image.split(separatorRegex)
                                .map(s => {
                                    s = s.trim();
                                    // ä»…å½“é“¾æ¥çœ‹èµ·æ¥è¢«URLç¼–ç äº†(æ¯”å¦‚å¼€å¤´æ˜¯http%3A)ï¼Œæ‰å°è¯•è§£ç 
                                    // å¦åˆ™ä¿æŒåŸæ ·ï¼Œé˜²æ­¢ç ´åæ­£å¸¸çš„é“¾æ¥ç»“æ„
                                    if (s.match(/^http%3A/i) || s.includes('%3A%2F%2F')) {
                                         try { return decodeURIComponent(s); } catch(e) { return s; }
                                    }
                                    return s;
                                })
                                .filter(s => s.startsWith('http'));
                        }
                        
                        if (imgArray.length === 0) {
                            imgArray = [this.defaultImages[imgKey]];
                        }

                        return {
                            id: index,
                            name: row.name || 'æœªå‘½å',
                            region: row.region || 'Sydney',
                            category: cat,
                            environment: row.environment ? row.environment.toLowerCase() : 'outdoor',
                            isFree: String(row.isFree).toUpperCase() === 'TRUE',
                            isPetFriendly: String(row.isPetFriendly).toUpperCase() === 'TRUE',
                            isFamilyFriendly: String(row.isFamilyFriendly).toUpperCase() === 'TRUE',
                            desc: row.desc || 'æš‚æ— æè¿°',
                            images: imgArray 
                        };
                    });

                    this.regions = [...new Set(this.places.map(p => p.region))].filter(Boolean).sort();
                    this.categories = [...new Set(this.places.map(p => p.category))].filter(Boolean).sort();
                },

                toggleFilter(arr, val) {
                    if (this[arr].includes(val)) this[arr] = this[arr].filter(x => x !== val);
                    else this[arr].push(val);
                    this.currentPage = 1;
                },
                toggleTag(tag) {
                    if (this.activeTags.includes(tag)) this.activeTags = this.activeTags.filter(t => t !== tag);
                    else this.activeTags.push(tag);
                    this.currentPage = 1;
                },
                get filteredPlaces() {
                    return this.places.filter(p => {
                        const q = this.search.toLowerCase();
                        const matchSearch = p.name.toLowerCase().includes(q) || p.region.toLowerCase().includes(q) || p.category.toLowerCase().includes(q);
                        const matchEnv = this.envFilter === 'all' || p.environment === this.envFilter;
                        const matchRegion = this.activeRegions.length === 0 || this.activeRegions.includes(p.region);
                        const matchCat = this.activeCategories.length === 0 || this.activeCategories.includes(p.category);
                        let matchTags = true;
                        if (this.activeTags.includes('pet') && !p.isPetFriendly) matchTags = false;
                        if (this.activeTags.includes('family') && !p.isFamilyFriendly) matchTags = false;
                        if (this.activeTags.includes('free') && !p.isFree) matchTags = false;
                        return matchSearch && matchEnv && matchRegion && matchCat && matchTags;
                    });
                },
                get paginatedPlaces() {
                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    return this.filteredPlaces.slice(start, start + this.itemsPerPage);
                },
                get totalPages() {
                    return Math.ceil(this.filteredPlaces.length / this.itemsPerPage);
                },
                changePage(page) {
                    this.currentPage = page;
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },
                openModal(place) {
                    this.modalData = place;
                    this.activeImgIndex = 0; 
                    this.showModal = true;
                },
                nextImg() {
                    if (!this.modalData) return;
                    const len = this.modalData.images.length;
                    this.activeImgIndex = (this.activeImgIndex + 1) % len;
                },
                prevImg() {
                    if (!this.modalData) return;
                    const len = this.modalData.images.length;
                    this.activeImgIndex = (this.activeImgIndex - 1 + len) % len;
                },
                
                pickRandom() {
                    const pool = this.filteredPlaces;
                    if (pool.length === 0) {
                        alert('å½“å‰ç­›é€‰ä¸‹æ²¡æœ‰åœ°æ–¹å¯å»ï¼Œæ¢ä¸ªæ¡ä»¶è¯•è¯•ï¼Ÿ');
                        return;
                    }
                    const random = pool[Math.floor(Math.random() * pool.length)];
                    this.openModal(random);
                },
                sharePlace(p) {
                    if(!p) return;
                    const text = `å‘¨æœ«å»å“ªé‡Œï¼Ÿ\nâœ¨ ${p.name}\nğŸ“ ${p.region}\nğŸ’¬ ${p.desc}`;
                    navigator.clipboard.writeText(text).then(() => alert('å†…å®¹å·²å¤åˆ¶ï¼'));
                }
            }
        }
    </script>
</body>
</html>
